<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pit Lane Kart Tracker</title>
<style>
body {
  font-family: Arial, sans-serif;
  background:#111;
  color:#eee;
  margin:0;
  padding:10px;
}

h2 { margin-top:20px; }

button, select, input {
  padding:6px;
  margin:4px;
}

.container {
  display:flex;
  gap:20px;
  flex-wrap:wrap;
}

.column {
  border:1px solid #444;
  padding:10px;
  border-radius:6px;
}

.row-container {
  display:flex;
  gap:20px;
}

.pit-row {
  display:flex;
  flex-direction:column;
  align-items:center;
  border:1px solid #555;
  padding:6px;
}

.kart {
  width:60px;
  height:60px;
  margin:4px 0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-size:12px;
  border-radius:6px;
  cursor:pointer;
}

.kart button {
  font-size:10px;
  padding:2px;
  margin-top:2px;
}

.blue { background:#2b6cff; }
.red { background:#cc3333; }
.orange { background:#ff9933; }
.yellow { background:#ffeb3b; color:#000; }
.green { background:#33cc66; }
.purple { background:#9c27b0; }

table {
  border-collapse:collapse;
  width:100%;
}

td, th {
  border:1px solid #555;
  padding:4px;
  font-size:12px;
}
</style>
</head>

<body>

<h1>Pit Lane Kart Tracker</h1>

<div class="container">

<div class="column">
<h2>Teams</h2>
<input id="teamName" placeholder="Team name">
<input id="teamKart" placeholder="Team kart number">
<button onclick="addTeam()">Add Team</button>
<ul id="teamList"></ul>
</div>

<div class="column">
<h2>Pit Setup</h2>
Rows: <input type="number" id="rowCount" value="2" min="1">
Karts/Row: <input type="number" id="kartsPerRow" value="4" min="1">
<button onclick="setupPits()">Initialize Pits</button>
</div>

</div>

<h2>Pit Lane</h2>
<div class="row-container" id="pitArea"></div>

<h2>Reserve Row</h2>
<button onclick="addReserveKart()">+ Add Reserve Kart</button>
<div class="pit-row" id="reserveRow"></div>

<h2>Team Kart History</h2>
<div id="historyArea"></div>

<script>
let teams = [];
let pitRows = [];
let reserveKarts = [];
let kartCounterP = 1;
let kartCounterR = 1;

const colors = ["blue","red","orange","yellow","green","purple"];

function addTeam() {
  const name = teamName.value;
  const kart = teamKart.value;
  if(!name || !kart) return;
  teams.push({name, teamKart:kart, currentKart:`K${kart}`, history:[]});
  teamName.value = teamKart.value = "";
  renderTeams();
  renderHistory();
}

function renderTeams() {
  teamList.innerHTML = "";
  teams.forEach(t=>{
    const li=document.createElement("li");
    li.textContent = `${t.name} (Team Kart ${t.teamKart})`;
    teamList.appendChild(li);
  });
}

function setupPits() {
  pitRows=[];
  kartCounterP=1;
  pitArea.innerHTML="";
  const rows = +rowCount.value;
  const perRow = +kartsPerRow.value;

  for(let r=0;r<rows;r++){
    const row=[];
    for(let k=0;k<perRow;k++){
      row.push({id:`P${kartCounterP++}`, color:"blue"});
    }
    pitRows.push(row);
  }
  renderPits();
}

function renderPits() {
  pitArea.innerHTML="";
  pitRows.forEach((row,ri)=>{
    const div=document.createElement("div");
    div.className="pit-row";
    row.forEach(k=>div.appendChild(renderKart(k)));
    const btn=document.createElement("button");
    btn.textContent="+";
    btn.onclick=()=>pitEntry(ri);
    div.appendChild(btn);
    pitArea.appendChild(div);
  });
  renderReserve();
}

function renderKart(kart) {
  const d=document.createElement("div");
  d.className=`kart ${kart.color}`;
  d.innerHTML=`${kart.id}`;
  const colorSel=document.createElement("select");
  colors.forEach(c=>{
    const o=document.createElement("option");
    o.value=c; o.textContent=c;
    if(c===kart.color) o.selected=true;
    colorSel.appendChild(o);
  });
  colorSel.onchange=()=>kart.color=colorSel.value;
  d.appendChild(colorSel);

  const swap=document.createElement("button");
  swap.textContent="Swap";
  swap.onclick=()=>swapKart(kart);
  d.appendChild(swap);
  return d;
}

function pitEntry(rowIndex) {
  const teamKart = prompt("Enter TEAM kart number:");
  const team = teams.find(t=>t.teamKart===teamKart);
  if(!team) return;

  const row = pitRows[rowIndex];
  const taken = row.shift();
  const leaving = {id:team.currentKart, color:taken.color};
  row.push(leaving);
  team.currentKart = taken.id;

  team.history.push({
    stint: team.history.length+1,
    kart: taken.id,
    color: taken.color
  });
  renderPits();
  renderHistory();
}

function addReserveKart() {
  reserveKarts.push({id:`R${kartCounterR++}`, color:"blue"});
  renderReserve();
}

function renderReserve() {
  reserveRow.innerHTML="";
  reserveKarts.forEach(k=>reserveRow.appendChild(renderKart(k)));
}

function swapKart(kart) {
  const all=[...pitRows.flat(), ...reserveKarts];
  const choice=prompt("Swap with kart ID:");
  const other=all.find(k=>k.id===choice);
  if(!other) return;
  [kart.id,other.id]=[other.id,kart.id];
  [kart.color,other.color]=[other.color,kart.color];
  renderPits();
}

function renderHistory() {
  historyArea.innerHTML="";
  teams.forEach(t=>{
    const h=document.createElement("div");
    h.innerHTML=`<h3>${t.name}</h3>`;
    const table=document.createElement("table");
    table.innerHTML="<tr><th>Stint</th><th>Kart</th><th>Color</th></tr>";
    t.history.forEach(s=>{
      table.innerHTML+=`<tr><td>${s.stint}</td><td>${s.kart}</td><td>${s.color}</td></tr>`;
    });
    h.appendChild(table);
    historyArea.appendChild(h);
  });
}
</script>

</body>
</html>
