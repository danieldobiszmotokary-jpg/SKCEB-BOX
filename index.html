<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Pit Lane Kart Tracker</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#111;
  color:#eee;
  margin:10px;
}
section {
  border:1px solid #444;
  padding:10px;
  margin-bottom:15px;
  border-radius:6px;
}
button, select, input {
  padding:6px;
  margin:3px;
}
.rows {
  display:flex;
  gap:15px;
}
.row {
  display:flex;
  flex-direction:column;
  align-items:center;
}
.kart {
  width:60px;
  height:60px;
  margin:4px;
  border-radius:6px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  color:#000;
}
.color-blue{background:#1e90ff;}
.color-red{background:#d9534f;}
.color-orange{background:#f0ad4e;}
.color-yellow{background:#ffd700;}
.color-green{background:#5cb85c;}
.color-purple{background:#9b59b6;}
table {
  width:100%;
  border-collapse:collapse;
}
td,th {
  border:1px solid #444;
  padding:4px;
  text-align:center;
}
</style>
</head>

<body>

<h1>Pit Lane Kart Tracker</h1>

<section>
  <h2>Setup</h2>
  Team name:
  <input id="teamName">
  Kart number:
  <input id="teamNumber" type="number">
  <button onclick="addTeam()">Add Team</button>
  <br><br>
  Rows:
  <input id="rowsCount" type="number" value="2">
  Karts per row:
  <input id="kartsPerRow" type="number" value="4">
  Reserve karts:
  <input id="reserveCount" type="number" value="3">
  <button onclick="initPits()">Initialize Pits</button>
</section>

<section>
  <h2>Teams on Track</h2>
  <div id="teams"></div>
</section>

<section>
  <h2>Pit Lane</h2>
  <div class="rows" id="pitRows"></div>
</section>

<section>
  <h2>Team Kart History</h2>
  <div id="history"></div>
</section>

<script>
const COLORS=["blue","red","orange","yellow","green","purple"];
let teams=[];
let pitRows=[];
let reserve=[];

const teamsDiv=document.getElementById("teams");
const pitRowsDiv=document.getElementById("pitRows");
const historyDiv=document.getElementById("history");

function colorClass(c){return "color-"+c;}

function addTeam(){
  if(!teamName.value||!teamNumber.value) return;
  const id=`K${teams.length+1}`;
  teams.push({
    name:teamName.value,
    number:teamNumber.value,
    kartId:id,
    color:"blue",
    history:[{stint:1,kartId:id,color:"blue"}]
  });
  render();
}

function initPits(){
  pitRows=[];
  let p=1;
  for(let i=0;i<rowsCount.value;i++){
    const row=[];
    for(let j=0;j<kartsPerRow.value;j++){
      row.push({id:`P${p++}`,color:"blue"});
    }
    pitRows.push(row);
  }
  reserve=[];
  for(let i=1;i<=reserveCount.value;i++){
    reserve.push({id:`R${i}`,color:"blue"});
  }
  render();
}

function enterPits(ti,ri){
  const team=teams[ti];
  const row=pitRows[ri];
  const front=row.shift();
  row.push({id:team.kartId,color:team.color});
  team.kartId=front.id;
  team.color=front.color;
  team.history.push({
    stint:team.history.length+1,
    kartId:front.id,
    color:front.color
  });
  render();
}

function setTeamColor(i,c){
  teams[i].color=c;
  render();
}

function setKartColor(row,i,c){
  row[i].color=c;
  render();
}

function swapKart(row,i){
  const all=[...pitRows.flat(),...reserve];
  const pick=prompt("Swap with kart ID:\n"+all.map(k=>k.id).join(", "));
  if(!pick) return;
  let target=null;
  pitRows.forEach(r=>r.forEach(k=>{if(k.id===pick)target=k;}));
  reserve.forEach(k=>{if(k.id===pick)target=k;});
  if(!target) return;
  [row[i].id,target.id]=[target.id,row[i].id];
  [row[i].color,target.color]=[target.color,row[i].color];
  render();
}

function render(){
  teamsDiv.innerHTML="";
  teams.forEach((t,i)=>{
    teamsDiv.innerHTML+=`
      <div>
        <b>${t.name}</b> (#${t.number}) – Kart ${t.kartId}
        <select onchange="setTeamColor(${i},this.value)">
          ${COLORS.map(c=>`<option ${c===t.color?"selected":""}>${c}</option>`).join("")}
        </select>
        ${pitRows.map((_,r)=>`<button onclick="enterPits(${i},${r})">Row ${r+1}</button>`).join("")}
      </div>`;
  });

  pitRowsDiv.innerHTML="";
  pitRows.forEach((row,ri)=>{
    const col=document.createElement("div");
    col.className="row";
    col.innerHTML=`<b>Row ${ri+1}</b>`;
    row.forEach((k,ki)=>{
      const d=document.createElement("div");
      d.className=`kart ${colorClass(k.color)}`;
      d.innerHTML=`
        ${k.id}
        <select onchange="setKartColor(pitRows[${ri}],${ki},this.value)">
          ${COLORS.map(c=>`<option ${c===k.color?"selected":""}>${c}</option>`).join("")}
        </select>
        <button onclick="swapKart(pitRows[${ri}],${ki})">↔</button>`;
      col.appendChild(d);
    });
    pitRowsDiv.appendChild(col);
  });

  historyDiv.innerHTML="";
  teams.forEach(t=>{
    let html=`<h4>${t.name}</h4><table><tr><th>Stint</th><th>Kart</th><th>Color</th></tr>`;
    t.history.forEach(h=>{
      html+=`<tr><td>${h.stint}</td><td>${h.kartId}</td><td>${h.color}</td></tr>`;
    });
    html+="</table>";
    historyDiv.innerHTML+=html;
  });
}
</script>

</body>
</html>
