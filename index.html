<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pit Lane Kart Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#111;
  color:#fff;
  font-family:Arial, sans-serif;
  padding:10px;
}

section {
  margin-bottom:20px;
}

button, select, input {
  padding:6px;
  font-size:14px;
  margin:4px 0;
}

.setup-grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.team-box, .kart {
  width:70px;
  height:70px;
  border-radius:6px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-size:12px;
  border:2px solid #000;
}

.blue {background:#3498db;}
.red {background:#e74c3c;}
.orange {background:#e67e22;}
.yellow {background:#f1c40f;color:#000;}
.green {background:#2ecc71;}
.purple {background:#9b59b6;}

.row {
  display:flex;
  gap:12px;
  align-items:flex-start;
  margin-bottom:20px;
}

.kart-column {
  display:flex;
  flex-direction:column;
  gap:6px;
}

.small {
  font-size:10px;
}
</style>
</head>

<body>

<h2>Setup</h2>
<section>
  Teams:
  <input id="teamCount" type="number" min="1" value="3">
  Rows:
  <input id="rowCount" type="number" min="1" value="2">
  Karts per row:
  <input id="kartsPerRow" type="number" min="1" value="3">
  <br>
  <button onclick="buildTeamInputs()">Next</button>
</section>

<section id="teamSetup"></section>

<section>
  <button onclick="initialize()">Initialize Pit Lane</button>
</section>

<hr>

<h2>Teams</h2>
<section id="teams"></section>

<h2>Pit Lane</h2>
<section id="pits"></section>

<script>
const COLORS = ["blue","red","orange","yellow","green","purple"];

let teams = [];
let rows = [];

function buildTeamInputs() {
  const count = +teamCount.value;
  const el = document.getElementById("teamSetup");
  el.innerHTML = "<h3>Teams</h3>";

  for (let i=0;i<count;i++) {
    el.innerHTML += `
      <div>
        Team name:
        <input id="tname${i}" value="Team ${i+1}">
        Kart #:
        <input id="tkart${i}" value="${i+1}">
      </div>`;
  }
}

function initialize() {
  const tCount = +teamCount.value;
  const rCount = +rowCount.value;
  const kCount = +kartsPerRow.value;

  teams = [];
  rows = [];

  for (let i=0;i<tCount;i++) {
    teams.push({
      name: document.getElementById(`tname${i}`).value,
      kart: document.getElementById(`tkart${i}`).value,
      color: "blue"
    });
  }

  for (let r=0;r<rCount;r++) {
    const row = [];
    for (let k=0;k<kCount;k++) {
      row.push({ kart: `P${r+1}-${k+1}`, color:"blue" });
    }
    rows.push(row);
  }

  render();
}

function colorSelect(current, onChange) {
  const s = document.createElement("select");
  COLORS.forEach(c=>{
    const o=document.createElement("option");
    o.value=c;
    o.textContent=c;
    if(c===current) o.selected=true;
    s.appendChild(o);
  });
  s.onchange=e=>onChange(e.target.value);
  return s;
}

function render() {
  renderTeams();
  renderPits();
}

function renderTeams() {
  const el = document.getElementById("teams");
  el.innerHTML="";
  teams.forEach(t=>{
    const d=document.createElement("div");
    d.className=`team-box ${t.color}`;
    d.innerHTML=`<b>${t.name}</b><div class="small">Kart ${t.kart}</div>`;
    d.appendChild(colorSelect(t.color,c=>{t.color=c;render();}));
    el.appendChild(d);
  });
}

function renderPits() {
  const el = document.getElementById("pits");
  el.innerHTML="";

  rows.forEach((row,ri)=>{
    const rowDiv=document.createElement("div");
    rowDiv.className="row";

    const col=document.createElement("div");
    col.className="kart-column";

    row.forEach(k=>{
      const d=document.createElement("div");
      d.className=`kart ${k.color}`;
      d.textContent=k.kart;
      d.appendChild(colorSelect(k.color,c=>{k.color=c;render();}));
      col.appendChild(d);
    });

    const controls=document.createElement("div");

    const teamSel=document.createElement("select");
    teams.forEach((t,i)=>{
      const o=document.createElement("option");
      o.value=i;
      o.textContent=t.name;
      teamSel.appendChild(o);
    });

    const btn=document.createElement("button");
    btn.textContent="+";
    btn.onclick=()=>pitStop(ri,+teamSel.value);

    controls.appendChild(teamSel);
    controls.appendChild(document.createElement("br"));
    controls.appendChild(btn);

    rowDiv.appendChild(col);
    rowDiv.appendChild(controls);
    el.appendChild(rowDiv);
  });
}

function pitStop(rowIndex, teamIndex) {
  const row = rows[rowIndex];
  const team = teams[teamIndex];

  const frontKart = row.shift();     // team takes first
  row.push({ kart: team.kart, color: team.color }); // team leaves kart

  team.kart = frontKart.kart;
  team.color = frontKart.color;

  render();
}
</script>

</body>
</html>
