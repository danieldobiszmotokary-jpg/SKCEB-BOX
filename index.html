<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Pit Lane Kart Tracker</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 10px;
  background: #111;
  color: #eee;
}
h2 { margin-top: 20px; }

section {
  border: 1px solid #444;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 6px;
}

button, select, input {
  margin: 3px;
  padding: 6px;
  font-size: 14px;
}

.flex {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.team-row {
  border-bottom: 1px solid #333;
  padding: 5px 0;
}

.color-blue { background:#1e90ff; }
.color-red { background:#d9534f; }
.color-orange { background:#f0ad4e; }
.color-yellow { background:#ffd700; }
.color-green { background:#5cb85c; }
.color-purple { background:#9b59b6; }

.kart {
  width: 60px;
  height: 60px;
  margin: 4px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border-radius: 6px;
  color: #000;
  font-weight: bold;
}

.row {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.rows-container {
  display: flex;
  gap: 15px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}
td, th {
  border: 1px solid #444;
  padding: 4px;
  text-align: center;
}
</style>
</head>

<body>

<h1>Pit Lane Kart Tracker</h1>

<!-- SETUP -->
<section>
  <h2>Setup</h2>
  Teams:
  <input id="teamName" placeholder="Team name">
  <input id="teamNumber" type="number" placeholder="Team kart number">
  <button onclick="addTeam()">Add Team</button>
  <br><br>
  Rows:
  <input id="rowsCount" type="number" value="2">
  Karts per row:
  <input id="kartsPerRow" type="number" value="4">
  Reserve karts:
  <input id="reserveCount" type="number" value="3">
  <button onclick="initPits()">Initialize Pits</button>
</section>

<!-- TEAMS -->
<section>
  <h2>Teams on Track</h2>
  <div id="teams"></div>
</section>

<!-- PITS -->
<section>
  <h2>Pit Lane</h2>
  <div class="rows-container" id="pitRows"></div>
</section>

<!-- HISTORY -->
<section>
  <h2>Team Kart History</h2>
  <div id="history"></div>
</section>

<script>
const COLORS = ["blue","red","orange","yellow","green","purple"];
let teams = [];
let pitRows = [];
let reserveRow = [];

function colorClass(c){ return "color-" + c; }

function addTeam(){
  const name = teamName.value;
  const num = teamNumber.value;
  if(!name || !num) return;

  teams.push({
    name,
    number:num,
    kartId:`K${teams.length+1}`,
    color:"blue",
    history:[{stint:1, kartId:`K${teams.length+1}`, color:"blue"}]
  });
  render();
}

function initPits(){
  pitRows = [];
  const r = rowsCount.value;
  const k = kartsPerRow.value;
  let p = 1;
  for(let i=0;i<r;i++){
    let row=[];
    for(let j=0;j<k;j++){
      row.push({id:`P${p++}`, color:"blue"});
    }
    pitRows.push(row);
  }
  reserveRow=[];
  for(let i=1;i<=reserveCount.value;i++){
    reserveRow.push({id:`R${i}`, color:"blue"});
  }
  render();
}

function enterPits(teamIndex,rowIndex){
  const team = teams[teamIndex];
  const row = pitRows[rowIndex];

  const taken = row.shift();
  row.push({id:team.kartId, color:team.color});

  team.kartId = taken.id;
  team.color = taken.color;
  team.history.push({
    stint:team.history.length+1,
    kartId:taken.id,
    color:taken.color
  });
  render();
}

function setTeamColor(i,c){
  teams[i].color=c;
  render();
}

function setKartColor(row,idx,c){
  row[idx].color=c;
  render();
}

function swapKart(sourceRow, sourceIdx){
  const all = [...pitRows.flat(), ...reserveRow];
  const sel = prompt(
    "Select kart ID to swap with:\n"+
    all.map(k=>k.id).join(", ")
  );
  if(!sel) return;
  let target;
  pitRows.forEach(r=>r.forEach(k=>{ if(k.id===sel) target=k; }));
  reserveRow.forEach(k=>{ if(k.id===sel) target=k; });
  if(!target) return;

  const tmpId = sourceRow[sourceIdx].id;
  const tmpCol = sourceRow[sourceIdx].color;
  sourceRow[sourceIdx].id = target.id;
  sourceRow[sourceIdx].color = target.color;
  target.id = tmpId;
  target.color = tmpCol;
  render();
}

function render(){
  // Teams
  teamsDiv.innerHTML="";
  teams.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className="team-row";
    d.innerHTML=`
      <b>${t.name}</b> (#${t.number}) |
      Kart: ${t.kartId}
      <select onchange="setTeamColor(${i},this.value)">
        ${COLORS.map(c=>`<option ${c===t.color?"selected":""}>${c}</option>`)}
      </select>
      ${pitRows.map((_,r)=>`<button onclick="enterPits(${i},${r})">Row ${r+1}</button>`).join("")}
    `;
    teamsDiv.appendChild(d);
  });

  // Pits
  pitRowsDiv.innerHTML="";
  pitRows.forEach((row,ri)=>{
    const rd=document.createElement("div");
    rd.className="row";
    rd.innerHTML=`<b>Row ${ri+1}</b>`;
    row.forEach((k,ki)=>{
      const d=document.createElement("div");
      d.className=`kart ${colorClass(k.color)}`;
      d.innerHTML=`
        ${k.id}
        <select onchange="setKartColor(pitRows[${ri}],${ki},this.value)">
          ${COLORS.map(c=>`<option ${c===k.color?"selected":""}>${c}</option>`)}
        </select>
        <button onclick="swapKart(pitRows[${ri}],${ki})">â†”</button>
      `;
      rd.appendChild(d);
    });
    pitRowsDiv.appendChild(rd);
  });

  // History
  historyDiv.innerHTML="";
  teams.forEach(t=>{
    let h=`<h4>${t.name}</h4><table><tr><th>Stint</th><th>Kart</th><th>Color</th></tr>`;
    t.history.forEach(s=>{
      h+=`<tr><td>${s.stint}</td><td>${s.kartId}</td><td>${s.color}</td></tr>`;
    });
    h+="</table>";
    historyDiv.innerHTML+=h;
  });
}
</script>

</body>
</html>
